<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

  <!-- FullCalendar Thai Locale -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales-all.global.min.js"></script>

  <style>
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background-color: rgba(59, 130, 246, 0.5);
      border-radius: 10px;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex">
  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow h-screen sticky top-0 p-6 space-y-4">
    <div class="text-xl font-bold text-blue-600 mb-4">Admin Panel</div>
    <nav class="flex flex-col gap-2">
      <button class="tab-btn text-left px-4 py-2 rounded hover:bg-blue-50" data-target="calendar">🗕️ ปฏิทิน</button>
      <button class="tab-btn text-left px-4 py-2 rounded hover:bg-blue-50" data-target="event">📋 รายการ Event</button>
      <button class="tab-btn text-left px-4 py-2 rounded hover:bg-blue-50 text-blue-700 font-semibold" data-target="user">👥 จัดการผู้ใช้</button>
      <button id="logoutBtn" class="text-left px-4 py-2 rounded hover:bg-blue-50 text-red-500 mt-8">🚪 ออกจากระบบ</button>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-grow max-w-7xl mx-auto px-4 py-6 space-y-6">
    <!-- ปฏิทิน -->
    <section id="section-calendar" class="hidden">
      <div class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-xl font-semibold mb-4">🗕️ ปฏิทินกิจกรรม</h2>
        <div id="calendar" class="bg-white p-6 rounded-2xl shadow-lg min-h-[600px]"></div>
      </div>
    </section>
    <!-- รายการ Event -->
    <section id="section-event" class="hidden">
      <div class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-xl font-semibold mb-4">📋 รายการ Event</h2>
        <p class="text-gray-600">กำลังพัฒนา</p>
      </div>
    </section>
    <!-- จัดการผู้ใช้ -->
    <section id="section-user">
      <!-- [Content omitted for brevity, already in your code above] -->
    </section>
  </main>

  <!-- Script -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
    const supabase = createClient('https://yyxovuybwuqvgtikujyi.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5eG92dXlid3Vxdmd0aWt1anlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwODE3MzQsImV4cCI6MjA2NjY1NzczNH0.QgvI_-w55PFXY0oz8U4ZeqFp4RDQlNFEMA4B40kkVtQ')

    const user = JSON.parse(localStorage.getItem('user') || '{}')
    if (!user.id || user.role !== 'admin') {
      alert('เฉพาะแอดมินเท่านั้น')
      location.href = 'login.html'
    }

    const tabButtons = document.querySelectorAll('.tab-btn')
    const sections = {
      calendar: document.getElementById('section-calendar'),
      event: document.getElementById('section-event'),
      user: document.getElementById('section-user')
    }

    let calendarInitialized = false
    tabButtons.forEach(btn => {
      btn.addEventListener('click', async () => {
        const target = btn.dataset.target
        for (let key in sections) {
          sections[key].classList.toggle('hidden', key !== target)
        }
        tabButtons.forEach(b => b.classList.remove('text-blue-700', 'font-semibold'))
        btn.classList.add('text-blue-700', 'font-semibold')

        if (target === 'calendar' && !calendarInitialized) {
          const { data: events } = await supabase.from('events').select('*')
          const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
            initialView: 'dayGridMonth',
            locale: 'th',
            headerToolbar: {
              left: 'prev,next today',
              center: 'title',
              right: 'dayGridMonth,timeGridWeek,listWeek'
            },
            events: events.map(ev => ({
              title: ev.title,
              start: ev.start_date,
              end: ev.end_date,
              url: ev.file_url
            })),
            eventClick(info) {
              if (info.event.url) {
                info.jsEvent.preventDefault()
                window.open(info.event.url, '_blank')
              }
            }
          })
          calendar.render()
          calendarInitialized = true
        }
      })
    })

    document.getElementById('logoutBtn').onclick = () => {
      localStorage.removeItem('user')
      location.href = 'index.html'
    }
  </script>
</body>
</html>
